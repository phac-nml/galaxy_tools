<tool id="mob_recon" name="MOB-Recon" version="1.4.5">
  <description>Type contigs and extract plasmid sequences</description>
  <requirements>
     <requirement type="package" version="1.4.5">mob_suite</requirement>
  </requirements>   
  <command detect_errors="exit_code">
  <![CDATA[  
    ln -s "${input}" "${input.name}"; 
    
    mob_recon  --num_threads \${GALAXY_SLOTS:-4} --infile "${input.name}" 
    #if str($adv_param.unicycler_contigs) == "True":
      --unicycler_contigs 
    #end if   
    #if str($adv_param.run_circlator) == "True":
      --run_circlator 
    #end if 
    #if str($adv_param.min_length_condition.min_length_param) == "True":
      --min_length ${adv_param.min_length_condition.min_length_value}
    #end if 
    '--run_typer' --outdir '.';
    ##print(${adv_param.min_length_condition.min_length_param});
    ##print(${adv_param.min_length_condition.min_length_value});
  ]]>  
  </command>
  <inputs>
    <param name="input" type="data" format="fasta" label="Input" help="FASTA file with contig(s)"/>
    <section name="adv_param" title="Advanced parameters" expanded="False">
      <param name="unicycler_contigs" label="Check for circularity flag generated by unicycler in contigs fasta headers" type="select" value="True">
        <option value="True">Yes</option>
        <option value="False">No</option>
      </param>
      <param name="run_circlator" label="Run circlator minums2 pipeline to check for circular contigs" type="select" value="True">
        <option value="True">Yes</option>
        <option value="False">No</option>
      </param>
      <conditional name="min_length_condition">
        <param name="min_length_param" label="Minimum length of contigs to classify" type="select" value="False">
          <option value="False">No</option>
          <option value="True">Yes</option>
       </param>   
        <when value="True">
          <param name="min_length_value" type="integer" value="500" min="50"/> 
        </when>  
        <when value="False"/>
      </conditional> 
    </section>  
  </inputs>
  <outputs>
    <data name="outfile1" format="tabular" from_work_dir="contig_report.txt" label="${tool.name}: Overall contig MOB-recon report"/> 
    <data name="outfile2" format="tabular" from_work_dir="repetitive_blast_report.txt" label="${tool.name}: Repetitive elements BLAST report"/>
    <data name="outfile3" format="fasta" from_work_dir="chromosome.fasta" label="${tool.name}: Chromosomal sequences"/>
    <data name="outfile4" format="tabular" from_work_dir="mobtyper_aggregate_report.txt" label="${tool.name}: Aggregate MOB-typer report for all contigs"/>
    <data name="outfile5" format="fasta" label="${tool.name}: Plasmid sequence" metadata_source="input" hidden="true">
        <discover_datasets pattern="plasmid_.+\.(?P&lt;ext&gt;.+)" ext="fasta" visible="true" assign_primary_output="true"/>
    </data>
    <!--collection name="list_output" type="list:list" label="Plasmid Sequences">
      <discover_datasets pattern="plasmid_.+\.(?P&lt;ext&gt;.+)"  ext="fasta"  visible="true" directory="."/>
    </collection-->
  </outputs>
  <tests>
    <test>
        <param name="input" value="plasmid_476.fasta" ftype="fasta"/>
        <section name="adv_param">
         <param name="evalue" value="0.00001"/>
         <param name="unicycler_contigs" value="True"/>
         <param name="run_circlator"  value="True"/>
        </section>
        <output name="outfile1">
          <assert_contents>
            <has_text text="NC_019097"/>
          </assert_contents>  
        </output> 
    </test>
  </tests>
  <help>

**Syntax**

This tool reconstructs individual plasmid sequences from draft genome assemblies using the plasmid reference databases.

For more information please visit https://github.com/phac-nml/mob-suite/. 

-----

**Input:**

A FASTA file with a single or multiple contigs (e.g. a draft genome assembly):


**Output:**

Tab-delimited report listing information for each input contig on its cluster number, possible replicon, relaxase, and repetitive elements types, etc. Refer to https://github.com/phac-nml/mob-suite#mob-recon-contig-report-format for the description of each column.


  </help>
  <citations>
    <citation type="bibtex">
  @misc{githubmob-suite,
  title = {MOB-Suite: Software tools for clustering, reconstruction and typing of plasmids from draft assemblies.},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/phac-nml/mob-suite},
    }</citation>
  </citations>
</tool>
